import httpx
import logging
from typing import Dict

def fetch_github_poc_data(cve: str) -> Dict:
    year = cve.split('-')[1]
    url = f"https://raw.githubusercontent.com/nomi-sec/PoC-in-GitHub/refs/heads/master/{year}/{cve}.json"
    
    pocs = []
    
    try:
        response = httpx.get(url, timeout=15)

        if response.status_code == 200:
            json_data = response.json()
            

            for entry in json_data:
                data = {
                    'github_url': 'N/A',
                    'github_description': None,
                    'github_date': 'N/A',
                    'github_tags': [],
                    'github_stars': 0
                }
    
                data['github_url'] = entry["html_url"]
                data['github_description'] = entry["description"]
                data['github_date'] = entry["updated_at"]
                data['github_tags'].extend(entry["topics"])
                data['github_stars'] = entry["stargazers_count"]
                                
                pocs.append(data)
            
    except Exception as e:
        logging.error(f"Error fetching JSON PoC data for CVE {cve}: {e}")

    return pocs
